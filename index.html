<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tablero de Control Docente</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Librerías añadidas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      :root {
        --bg: #f4f1ea;
        --card: #ffffff;
        --primary: #2a9d8f;
        --primary-dark: #1f776d;
        --text: #2d3142;
        --muted: #6f737b;
        --success: #2b9348;
        --warning: #e9c46a;
        --danger: #e76f51;
        --auth-info-min-width: 280px;
        --auth-form-min-width: 320px;
        --auth-form-max-width: 400px;
        font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: var(--bg);
        color: var(--text);
      }

      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(160deg, #264653 0%, #2a9d8f 45%, #f4f1ea 100%);
      }
      header {
        display: flex; align-items: center; justify-content: space-between;
        padding: 1.5rem clamp(1rem, 2vw + 0.5rem, 3rem); color: white;
        position: sticky; top: 0; backdrop-filter: blur(18px);
        background: color-mix(in srgb, var(--primary) 70%, transparent);
        z-index: 10;
      }
      header h1 {
        margin: 0; font-size: clamp(1.5rem, 2.5vw, 2.4rem);
        font-weight: 700; letter-spacing: -0.03em;
      }
      header .user-meta { display: flex; gap: 1.25rem; align-items: center; font-size: 0.95rem; }
      header button {
        border: none; border-radius: 999px; padding: 0.65rem 1.35rem; font-weight: 600;
        cursor: pointer; transition: transform 0.18s ease, box-shadow 0.18s ease;
        background: white; color: var(--primary);
        box-shadow: 0 8px 20px -12px rgba(38, 70, 83, 0.35);
        display: inline-flex; align-items: center; gap: 0.5rem;
      }
      header button:hover { transform: translateY(-1px); box-shadow: 0 12px 24px -12px rgba(38, 70, 83, 0.45); }
      main { padding: clamp(1rem, 3vw, 2.5rem); max-width: 1280px; margin: 0 auto; }
      .hidden { display: none !important; }

      /* --- Estilos de Autenticación --- */
      #authSection { display: flex; align-items: center; justify-content: center; padding: clamp(2rem, 6vw, 5rem) 0; }
      .auth-grid {
        display: grid; grid-template-columns: minmax(var(--auth-info-min-width), 1fr) minmax(var(--auth-form-min-width), var(--auth-form-max-width));
        align-items: stretch; gap: clamp(1.5rem, 4vw, 3rem);
        max-width: 980px; margin: 0 auto; width: 100%;
      }
      .auth-hero {
        position: relative; border-radius: 28px; padding: clamp(1.75rem, 4vw, 3rem);
        background: linear-gradient(150deg, rgba(38, 70, 83, 0.92), rgba(42, 157, 143, 0.9));
        color: white; display: flex; flex-direction: column; gap: 1.5rem;
        box-shadow: 0 35px 70px -45px rgba(17, 51, 61, 0.75); overflow: hidden;
      }
      .auth-hero::after {
        content: ""; position: absolute; inset: 0;
        background: radial-gradient(circle at top right, rgba(233, 196, 106, 0.35), transparent 55%);
        pointer-events: none;
      }
      .auth-hero > * { position: relative; z-index: 1; }
      .eyebrow {
        display: inline-flex; align-items: center; gap: 0.4rem; font-size: 0.8rem;
        letter-spacing: 0.2em; text-transform: uppercase; font-weight: 600;
        color: rgba(255, 255, 255, 0.75);
      }
      .auth-hero h2 { margin: 0; font-size: clamp(1.8rem, 3vw, 2.5rem); line-height: 1.2; }
      .auth-hero p { margin: 0; font-size: 1rem; color: rgba(255, 255, 255, 0.85); }
      .auth-highlights { list-style: none; margin: 0; padding: 0; display: grid; gap: 0.85rem; }
      .auth-highlights li { display: flex; gap: 0.75rem; align-items: flex-start; font-weight: 500; }
      .auth-highlights li::before {
        content: "✔"; display: inline-flex; width: 1.5rem; height: 1.5rem; border-radius: 999px;
        align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2);
        color: white; font-size: 0.9rem; margin-top: 0.15rem;
      }
      
      /* --- Estilos de Componentes --- */
      .card {
        background: var(--card); border-radius: 24px;
        padding: clamp(1.5rem, 3vw, 2.5rem);
        box-shadow: 0 30px 60px -40px rgba(38, 70, 83, 0.45);
        border: 1px solid rgba(42, 157, 143, 0.12);
      }
      .card h2 { margin-top: 0; font-size: 1.45rem; font-weight: 600; letter-spacing: -0.02em; }
      form { display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem; }
      label { font-size: 0.9rem; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
      input, select, textarea {
        border: 1px solid rgba(42, 157, 143, 0.25); border-radius: 14px;
        padding: 0.85rem 1rem; font-size: 1rem; font-family: inherit;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        background: rgba(255, 255, 255, 0.8); color: var(--text);
      }
      input::placeholder, textarea::placeholder { color: color-mix(in srgb, var(--text) 60%, transparent); }
      input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(42, 157, 143, 0.2); }
      button.primary {
        border: none; border-radius: 16px; padding: 0.85rem 1.5rem;
        font-size: 1rem; font-weight: 600; cursor: pointer;
        background: linear-gradient(120deg, var(--primary), #3fb9a9); color: white;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
        box-shadow: 0 20px 35px -22px rgba(38, 70, 83, 0.45);
        display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
      }
      button.primary:hover { transform: translateY(-1px); box-shadow: 0 22px 40px -20px rgba(38, 70, 83, 0.5); }
      .alert {
        border-radius: 16px; padding: 0.95rem 1.25rem; font-size: 0.92rem;
        font-weight: 500; display: flex; gap: 0.75rem; align-items: center;
        opacity: 0; transform: translateY(-10px); transition: opacity 0.3s ease, transform 0.3s ease;
      }
      .alert.show { opacity: 1; transform: translateY(0); }
      .alert.info { background: rgba(42, 157, 143, 0.12); color: var(--primary); border: 1px solid rgba(42, 157, 143, 0.2); }
      .alert.error { background: rgba(231, 111, 81, 0.12); color: var(--danger); border: 1px solid rgba(231, 111, 81, 0.18); }
      .alert.success { background: rgba(43, 147, 72, 0.12); color: var(--success); border: 1px solid rgba(43, 147, 72, 0.18); }

      /* --- Estilos del Dashboard --- */
      .dashboard { display: grid; grid-template-columns: minmax(260px, 300px) 1fr; gap: 1.75rem; margin-top: 2rem; }
      .sidebar { background: rgba(255, 255, 255, 0.92); border-radius: 24px; padding: 1.75rem; display: flex; flex-direction: column; gap: 1.5rem; border: 1px solid rgba(42, 157, 143, 0.1); }
      .user-card h3 { margin: 0; font-size: 1.25rem; }
      nav ul { list-style: none; padding: 0; margin: 0; display: grid; gap: 0.65rem; }
      nav button {
        border: none; border-radius: 14px; padding: 0.75rem 1rem; font-size: 0.95rem; font-weight: 600;
        text-align: left; cursor: pointer; background: rgba(42, 157, 143, 0.08); color: var(--primary);
        transition: background 0.2s ease, transform 0.18s ease; display: flex; align-items: center; gap: 0.6rem;
      }
      nav button:hover, nav button.active { background: rgba(42, 157, 143, 0.16); transform: translateX(2px); }
      .content-area { display: grid; gap: 1.75rem; }
      .grid { display: grid; gap: 1rem; }
      table {
        width: 100%; border-collapse: collapse; border-radius: 18px; overflow: hidden;
        background: rgba(255, 255, 255, 0.92); border: 1px solid rgba(42, 157, 143, 0.12);
      }
      th, td { padding: 0.9rem 1.1rem; text-align: left; font-size: 0.95rem; vertical-align: middle; }
      tr:nth-child(even) { background: rgba(42, 157, 143, 0.06); }
      .badge {
        display: inline-flex; align-items: center; justify-content: center; border-radius: 999px;
        padding: 0.35rem 0.85rem; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;
      }
      .badge.admin { background: rgba(42, 157, 143, 0.18); color: var(--primary); }
      .badge.docente { background: rgba(43, 147, 72, 0.14); color: var(--success); }
      .badge.auxiliar { background: rgba(233, 196, 106, 0.2); color: var(--warning); }
      .empty-state {
        padding: 2rem; text-align: center; background: rgba(42, 157, 143, 0.08);
        border-radius: 18px; border: 1px dashed rgba(42, 157, 143, 0.25); color: var(--muted);
      }
      .action-buttons { display: flex; gap: 0.5rem; }
      .action-buttons button { background: transparent; border: none; cursor: pointer; padding: 0.4rem; border-radius: 8px; transition: background 0.2s; }
      .action-buttons button:hover { background: rgba(0,0,0,0.08); }
      .action-buttons .edit-btn { color: var(--primary); }
      .action-buttons .delete-btn { color: var(--danger); }
      
      /* --- Estilos de Loading y Modal (Nuevos) --- */
      #loader {
        position: fixed; inset: 0; background: rgba(255, 255, 255, 0.8);
        display: flex; align-items: center; justify-content: center;
        z-index: 9999; backdrop-filter: blur(8px);
      }
      .spinner {
        width: 56px; height: 56px; border-radius: 50%;
        border: 6px solid rgba(42, 157, 143, 0.2);
        border-top-color: var(--primary);
        animation: spin 1s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }

      #modal-backdrop {
        position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6);
        z-index: 1000; backdrop-filter: blur(5px);
        display: flex; align-items: center; justify-content: center;
      }
      .modal-content {
        background: white; border-radius: 24px; padding: 2rem;
        width: 100%; max-width: 500px;
        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        transform: scale(0.95); opacity: 0;
        animation: modal-in 0.3s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
      }
      @keyframes modal-in { to { transform: scale(1); opacity: 1; } }
      .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
      .modal-header h3 { margin: 0; font-size: 1.35rem; }
      .modal-header button { background: transparent; border: none; cursor: pointer; }
      
      /* --- Estilos de Impresión (Nuevos) --- */
      @media print {
        body { background: none; }
        header, .sidebar, form, .action-buttons, .tab-group, #printReport, .welcome-card { display: none; }
        main { padding: 0; max-width: 100%; }
        .dashboard { grid-template-columns: 1fr; }
        .card { box-shadow: none; border: 1px solid #ccc; }
        h1 { color: black; text-align: center; }
        @page { size: auto; margin: 0.5in; }
      }

      @media (max-width: 980px) {
        header { flex-direction: column; gap: 1rem; }
        .auth-grid { grid-template-columns: 1fr; }
        .dashboard { grid-template-columns: 1fr; }
        nav button { text-align: center; justify-content: center; }
      }
    </style>
</head>
<body>
    <!-- Elementos nuevos para loader y modal -->
    <div id="loader">
      <div class="spinner"></div>
    </div>
    <div id="modal-backdrop" class="hidden"></div>

    <header>
      <h1><i data-lucide="layout-dashboard"></i> Tablero de Control Docente</h1>
      <div class="user-meta hidden" id="headerUserMeta">
        <span id="headerUserName"></span>
        <span class="badge" id="headerUserRole"></span>
        <button id="logoutBtn" type="button"><i data-lucide="log-out"></i><span>Cerrar sesión</span></button>
      </div>
    </header>

    <main>
      <section id="authSection">
        <div class="auth-grid">
          <div class="auth-hero">
            <span class="eyebrow">Gestión académica</span>
            <h2>Organiza el trabajo docente con claridad</h2>
            <p>Centraliza indicadores, actividades y seguimientos en un solo lugar.</p>
            <ul class="auth-highlights">
              <li>Visualiza el avance de las actividades en tiempo real.</li>
              <li>Coordina responsabilidades entre docentes y auxiliares.</li>
              <li>Genera reportes claros para la toma de decisiones.</li>
            </ul>
          </div>

          <div class="card" id="loginCard">
            <h2>Bienvenido de nuevo</h2>
            <p>Accede con tu correo institucional <strong>@potros.itson.edu.mx</strong>.</p>
            <form>
              <button class="primary" type="button" id="googleLoginButton">
                <i data-lucide="log-in"></i>
                <span>Ingresar con Google</span>
              </button>
            </form>
            <div class="alert error" id="loginError" style="margin-top: 1rem"></div>
          </div>
        </div>
      </section>

      <section id="dashboard" class="hidden">
        <div class="dashboard">
          <aside class="sidebar">
            <div class="user-card">
              <h3 id="sidebarName"></h3>
              <div class="meta-list">
                <span id="sidebarEmail"></span>
                <span id="sidebarCareer"></span>
              </div>
            </div>
            <nav><ul id="navigation"></ul></nav>
          </aside>
          <section class="content-area">
            <!-- Vistas de Admin -->
            <div id="adminView" class="hidden">
              <div class="card">
                <h2>Reporte General</h2>
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 2rem;">
                  <div>
                    <h4>Usuarios por Carrera</h4>
                    <canvas id="usersChart"></canvas>
                  </div>
                  <div>
                    <h4>Estado de Actividades</h4>
                    <canvas id="activitiesChart"></canvas>
                  </div>
                </div>
              </div>
              <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2>Gestión del Sistema</h2>
                    <button class="primary" id="printReport" type="button"><i data-lucide="printer"></i> Imprimir Reporte</button>
                </div>
                <!-- ... el resto del contenido de admin ... -->
                <div id="admin-user-management">
                  <h3>Usuarios Registrados</h3>
                  <div id="userTableContainer"></div>
                </div>
              </div>
            </div>

            <!-- Vistas de Docente -->
            <div id="docenteView" class="hidden">
              <div class="card">
                <h2>Mis Actividades</h2>
                <div id="teacherActivities" style="margin-top: 1.25rem"></div>
              </div>
            </div>

            <!-- Vistas de Auxiliar -->
            <div id="auxiliarView" class="hidden">
              <div class="card">
                <h2>Actividades de Apoyo</h2>
                <div id="assistantActivities" style="margin-top: 1.25rem"></div>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>

    <script type="module">
      // Usamos una versión más reciente de Firebase para mejoras de rendimiento y seguridad
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, addDoc, collection, getDocs, onSnapshot, query, where, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBWa6nNgWGdsqS12OhqAfIlJcSbT59cLGs",
        authDomain: "tablerocontroldocente.firebaseapp.com",
        projectId: "tablerocontroldocente",
        storageBucket: "tablerocontroldocente.appspot.com", // Corregido el dominio
        messagingSenderId: "184781501380",
        appId: "1:184781501380:web:cc14875f679e077f28ea91"
      };

      // --- Constantes y Configuración ---
      const ALLOWED_DOMAIN = "@potros.itson.edu.mx";
      const ADMIN_EMAILS = new Set(["isaac.paniagua@potros.itson.edu.mx"]);
      const CAREER_LABELS = {
        software: "Ing. en Software",
        manufactura: "Ing. en Manufactura",
        mecatronica: "Ing. en Mecatrónica",
        global: "Global"
      };
      const ROLE_LABELS = {
        administrador: "Admin",
        docente: "Docente",
        auxiliar: "Auxiliar"
      };
      const ROLE_BADGE_CLASS = {
        administrador: "badge admin",
        docente: "badge docente",
        auxiliar: "badge auxiliar"
      };
      
      // --- Inicialización de Firebase ---
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // --- Referencias a Elementos del DOM ---
      const loader = document.getElementById('loader');
      const authSection = document.getElementById('authSection');
      const dashboard = document.getElementById('dashboard');
      // ... más referencias a elementos
      const googleLoginButton = document.getElementById('googleLoginButton');
      const loginError = document.getElementById('loginError');
      const headerUserMeta = document.getElementById("headerUserMeta");
      const headerUserName = document.getElementById("headerUserName");
      const headerUserRole = document.getElementById("headerUserRole");
      const logoutBtn = document.getElementById("logoutBtn");
      const sidebarName = document.getElementById("sidebarName");
      const sidebarEmail = document.getElementById("sidebarEmail");
      const sidebarCareer = document.getElementById("sidebarCareer");
      const navigation = document.getElementById("navigation");
      const userTableContainer = document.getElementById("userTableContainer");

      let currentUser = null;
      let currentUserData = null;
      let usersChart = null;
      let activitiesChart = null;
      let unsubscribers = [];

      // --- Funciones de Utilidad ---
      const showLoader = (show) => loader.classList.toggle('hidden', !show);

      const showAlert = (element, message, type = 'error', duration = 4000) => {
          element.textContent = message;
          element.className = `alert ${type} show`;
          setTimeout(() => {
              element.classList.remove('show');
          }, duration);
      };

      const openModal = (title, content) => {
        const backdrop = document.getElementById('modal-backdrop');
        backdrop.innerHTML = `
          <div class="modal-content">
            <div class="modal-header">
              <h3>${title}</h3>
              <button id="closeModalBtn"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">${content}</div>
          </div>
        `;
        backdrop.classList.remove('hidden');
        lucide.createIcons();
        document.getElementById('closeModalBtn').addEventListener('click', closeModal);
      };

      const closeModal = () => {
        document.getElementById('modal-backdrop').classList.add('hidden');
      };

      const cleanupSubscriptions = () => {
        unsubscribers.forEach(unsub => unsub());
        unsubscribers = [];
      };

      // --- Lógica de Renderizado ---
      const renderUserTable = () => {
        const q = query(collection(db, "users"), orderBy("displayName"));
        const unsubscribe = onSnapshot(q, (snapshot) => {
          if (snapshot.empty) {
            userTableContainer.innerHTML = `<div class="empty-state">No hay usuarios registrados.</div>`;
            return;
          }
          let tableHTML = `
            <table>
              <thead><tr><th>Nombre</th><th>Carrera</th><th>Rol</th><th>Acciones</th></tr></thead>
              <tbody>
          `;
          snapshot.docs.forEach(docSnap => {
            const user = docSnap.data();
            tableHTML += `
              <tr>
                <td>${user.displayName}<br><small>${user.email}</small></td>
                <td>${CAREER_LABELS[user.career] || user.career}</td>
                <td><span class="${ROLE_BADGE_CLASS[user.role]}">${ROLE_LABELS[user.role]}</span></td>
                <td>
                  <div class="action-buttons">
                    <button class="edit-btn" data-id="${docSnap.id}"><i data-lucide="edit"></i></button>
                    <button class="delete-btn" data-id="${docSnap.id}"><i data-lucide="trash-2"></i></button>
                  </div>
                </td>
              </tr>
            `;
          });
          tableHTML += '</tbody></table>';
          userTableContainer.innerHTML = tableHTML;
          lucide.createIcons();
        });
        unsubscribers.push(unsubscribe);
      };
      
      const renderAdminCharts = () => {
        const unsubscribeUsers = onSnapshot(collection(db, "users"), (snapshot) => {
          const careerCounts = { software: 0, manufactura: 0, mecatronica: 0 };
          snapshot.forEach(doc => {
            const user = doc.data();
            if(careerCounts[user.career] !== undefined) careerCounts[user.career]++;
          });
          const userCtx = document.getElementById('usersChart').getContext('2d');
          if(usersChart) usersChart.destroy();
          usersChart = new Chart(userCtx, {
            type: 'doughnut',
            data: {
              labels: Object.keys(careerCounts).map(c => CAREER_LABELS[c]),
              datasets: [{ data: Object.values(careerCounts), backgroundColor: ['#2a9d8f', '#e9c46a', '#e76f51'] }]
            }
          });
        });
        unsubscribers.push(unsubscribeUsers);
      };

      const renderDashboard = async (user, userData) => {
          currentUser = user;
          currentUserData = userData;
          
          // Actualizar UI
          headerUserName.textContent = userData.displayName;
          headerUserRole.className = ROLE_BADGE_CLASS[userData.role];
          headerUserRole.textContent = ROLE_LABELS[userData.role];
          sidebarName.textContent = userData.displayName;
          sidebarEmail.textContent = user.email;
          sidebarCareer.textContent = CAREER_LABELS[userData.career];
          headerUserMeta.classList.remove('hidden');

          cleanupSubscriptions();

          // Lógica de vistas por rol
          if (userData.role === 'administrador') {
              document.getElementById('adminView').classList.remove('hidden');
              renderUserTable();
              renderAdminCharts();
          } else if (userData.role === 'docente') {
              document.getElementById('docenteView').classList.remove('hidden');
          } else {
              document.getElementById('auxiliarView').classList.remove('hidden');
          }

          dashboard.classList.remove('hidden');
          authSection.classList.add('hidden');
          lucide.createIcons();
          showLoader(false);
      };

      // --- Lógica de Autenticación y Carga de Usuario ---
      onAuthStateChanged(auth, async (user) => {
          if (user) {
              if(!user.email.endsWith(ALLOWED_DOMAIN)) {
                  showAlert(loginError, "Debes usar una cuenta @potros.itson.edu.mx.");
                  await signOut(auth);
                  return;
              }
              const userRef = doc(db, "users", user.uid);
              let userDoc = await getDoc(userRef);

              if (!userDoc.exists()) {
                  // Creación de usuario por primera vez
                  const newUser = {
                      uid: user.uid,
                      displayName: user.displayName,
                      email: user.email,
                      career: 'software', // Carrera por defecto
                      role: ADMIN_EMAILS.has(user.email) ? 'administrador' : 'docente',
                      createdAt: serverTimestamp()
                  };
                  await setDoc(userRef, newUser);
                  userDoc = await getDoc(userRef);
              }
              
              const userData = userDoc.data();
              // Forzar rol de admin si el email está en la lista (seguridad extra)
              if(ADMIN_EMAILS.has(userData.email) && userData.role !== 'administrador'){
                await updateDoc(userRef, { role: 'administrador' });
                userData.role = 'administrador';
              }

              renderDashboard(user, userData);
          } else {
              // Limpiar UI para estado de no-autenticado
              currentUser = null;
              currentUserData = null;
              dashboard.classList.add('hidden');
              authSection.classList.remove('hidden');
              headerUserMeta.classList.add('hidden');
              cleanupSubscriptions();
              showLoader(false);
          }
      });
      
      googleLoginButton.addEventListener('click', async () => {
          const provider = new GoogleAuthProvider();
          provider.setCustomParameters({ hd: 'potros.itson.edu.mx' });
          try {
              showLoader(true);
              await signInWithPopup(auth, provider);
          } catch (error) {
              showAlert(loginError, 'Error al iniciar sesión. Intenta de nuevo.');
              showLoader(false);
          }
      });
      
      logoutBtn.addEventListener('click', () => signOut(auth));
      document.getElementById('printReport').addEventListener('click', () => window.print());

      // --- Inicialización ---
      lucide.createIcons();
      showLoader(true); // Mostrar loader al cargar la página
    </script>
</body>
</html>
