<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tablero de Control Docente</title>
    <!-- Fuentes y Librerías -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Hoja de Estilos Propia -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Elementos para loader y modal -->
    <div id="loader">
      <div class="spinner"></div>
    </div>
    <div id="modal-backdrop" class="hidden"></div>

    <header class="app-header">
      <div class="app-header__inner">
        <div class="brand-area">
          <span class="brand-pill">ITSon</span>
          <div>
            <h1>
              <i data-lucide="layout-dashboard"></i> Tablero de Control Docente
            </h1>
            <p class="brand-description">
              Planifica, monitorea y comunica el trabajo académico en una
              interfaz unificada.
            </p>
          </div>
        </div>
        <div class="header-tools">
          <div class="user-meta hidden" id="headerUserMeta">
            <span id="headerUserName"></span>
            <span class="badge" id="headerUserRole"></span>
            <button id="logoutBtn" type="button">
              <i data-lucide="log-out"></i><span>Cerrar sesión</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- Sección de Autenticación -->
      <section id="authSection">
        <div class="auth-layout">
          <div class="auth-hero">
            <span class="eyebrow">Gestión académica</span>
            <h2>Organiza el trabajo docente con claridad</h2>
            <p>
              Centraliza indicadores, actividades y seguimientos en un solo
              lugar.
            </p>
            <ul class="auth-highlights">
              <li>Visualiza el avance de las actividades en tiempo real.</li>
              <li>Coordina responsabilidades entre docentes y auxiliares.</li>
              <li>Genera reportes claros para la toma de decisiones.</li>
            </ul>
            <div class="auth-metrics">
              <div>
                <span class="metric-value">+120</span>
                <span class="metric-label">Actividades gestionadas</span>
              </div>
              <div>
                <span class="metric-value">8</span>
                <span class="metric-label">Programas académicos</span>
              </div>
              <div>
                <span class="metric-value">24/7</span>
                <span class="metric-label">Acceso disponible</span>
              </div>
            </div>
          </div>

          <div class="auth-panel">
            <div class="card" id="loginCard">
              <div class="card-header">
                <div>
                  <span class="eyebrow">Bienvenido</span>
                  <h2>Ingresa a tu panel</h2>
                </div>
                <i data-lucide="lock"></i>
              </div>
              <p>
                Accede con tu correo institucional
                <strong>@potros.itson.edu.mx</strong> y gestiona tus tareas sin
                complicaciones. Inicia sesión con Google para validar tus
                permisos en la plataforma.
              </p>
              <div class="form-actions">
                <button class="primary" type="button" id="googleSignInBtn">
                  <i data-lucide="log-in"></i>
                  <span>Ingresar con Google</span>
                </button>
              </div>
              <p class="form-help">
                Solo se permiten cuentas de Google con dominio
                <strong>@potros.itson.edu.mx</strong>. Si necesitas acceso,
                contacta al administrador principal.
              </p>
              <div class="alert error" id="loginError"></div>
            </div>
            <div class="auth-support">
              <div class="auth-support__intro">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M3 11h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-5Zm0 0a9 9 0 1 1 18 0m0 0v5a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3Z"
                  ></path>
                  <path d="M21 16v2a4 4 0 0 1-4 4h-5"></path>
                </svg>
                <div>
                  <h3>¿Necesitas ayuda?</h3>
                  <p>
                    Nuestro equipo académico puede orientarte con la migración
                    de datos o la incorporación de nuevos usuarios.
                  </p>
                </div>
              </div>
              <ul>
                <li>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"
                    ></path>
                    <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                  </svg>
                  isaac.paniagua@potros.itson.edu.mx
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Dashboard Principal -->
      <section id="dashboard" class="hidden">
        <div class="dashboard-shell" id="dashboardShell">
          <aside class="sidebar">
            <button
              type="button"
              class="sidebar-toggle"
              id="sidebarCollapseBtn"
              aria-label="Ocultar menú lateral"
              aria-expanded="true"
            >
              <i data-lucide="panel-left-close"></i>
              <span>Ocultar menú</span>
            </button>
            <div class="user-card">
              <span class="user-badge">Sesión activa</span>
              <h3 id="sidebarName"></h3>
              <div class="meta-list">
                <span id="sidebarEmail"></span>
                <span id="sidebarCareer"></span>
              </div>
            </div>
            <nav>
              <h4>Secciones</h4>
              <ul id="navigation"></ul>
            </nav>
            <div class="sidebar-footer">
              <p>
                Mantente al día con tus actividades y comparte avances con tu
                coordinación.
              </p>
            </div>
          </aside>
          <section class="content-area">
            <button
              type="button"
              class="sidebar-toggle sidebar-toggle--floating"
              id="sidebarExpandBtn"
              aria-label="Mostrar menú lateral"
              hidden
            >
              <i data-lucide="panel-left"></i>
              <span>Mostrar menú</span>
            </button>
            <div
              class="content-intro"
              id="dashboardIntro"
              data-nav-label="Panel de control"
              data-nav-roles="administrador,docente,auxiliar"
            >
              <div>
                <h2>Panel de control</h2>
                <p>
                  Revisa tus indicadores, tareas y reportes de manera visual y
                  organizada.
                </p>
              </div>
              <button class="ghost" type="button" id="printReport">
                <i data-lucide="printer"></i> Imprimir reporte
              </button>
            </div>

            <!-- Vistas de Admin -->
            <div id="adminView" class="hidden">
              <div
                class="overview-grid"
                id="dashboardHighlights"
                data-nav-label="Resumen"
                data-nav-roles="administrador"
              >
                <article class="summary-card">
                  <i data-lucide="users"></i>
                  <div>
                    <h3>Usuarios por carrera</h3>
                    <p>Identifica la distribución y crecimiento de docentes.</p>
                  </div>
                </article>
                <article class="summary-card">
                  <i data-lucide="check-circle"></i>
                  <div>
                    <h3>Estado de actividades</h3>
                    <p>Evalúa el progreso y detecta tareas pendientes.</p>
                  </div>
                </article>
                <article class="summary-card">
                  <i data-lucide="upload-cloud"></i>
                  <div>
                    <h3>Importación inteligente</h3>
                    <p>Integra nuevos docentes con plantillas precargadas.</p>
                  </div>
                </article>
              </div>

              <div
                class="card"
                id="generalReportCard"
                data-nav-label="Reporte general"
                data-nav-roles="administrador"
              >
                <div class="card-title">
                  <div>
                    <h2>Reporte General</h2>
                    <p class="card-subtitle">
                      Analiza de forma visual la actividad del departamento.
                    </p>
                  </div>
                  <div class="card-actions">
                    <button class="ghost" type="button" id="refreshDashboard">
                      <i data-lucide="refresh-cw"></i> Actualizar
                    </button>
                  </div>
                </div>
                <div class="chart-grid">
                  <div class="chart-card">
                    <header>
                      <h4>Usuarios por Carrera</h4>
                    </header>
                    <canvas id="usersChart"></canvas>
                  </div>
                  <div class="chart-card">
                    <header>
                      <h4>Estado de Actividades</h4>
                    </header>
                    <canvas id="activitiesChart"></canvas>
                  </div>
                </div>
              </div>

              <div
                class="card"
                id="userManagementCard"
                data-nav-label="Gestión de usuarios"
                data-nav-roles="administrador"
              >
                <div class="card-title">
                  <div>
                    <h2>Gestión de usuarios</h2>
                    <p class="card-subtitle">
                      Consulta, importa y gestiona el acceso a la plataforma.
                    </p>
                  </div>
                </div>
                <div id="admin-user-management">
                  <div class="import-toolbar">
                    <button class="primary" type="button" id="importTeachersBtn">
                      <i data-lucide="file-input"></i>
                      <span>Importar docentes de Ing. en Software</span>
                    </button>
                    <div id="importTeachersAlert"></div>
                  </div>
                  <div class="user-management-actions">
                    <button
                      class="primary"
                      type="button"
                      id="startAddUserBtn"
                      hidden
                    >
                      <i data-lucide="user-plus"></i>
                      <span>Agregar usuario</span>
                    </button>
                  </div>
                  <form id="userForm" class="user-form" hidden>
                    <header class="user-form-header">
                      <h3 id="userFormTitle">Agregar usuario</h3>
                      <p id="userFormDescription">
                        Registra un nuevo docente, administrador o auxiliar.
                      </p>
                    </header>
                    <div class="form-grid">
                      <div class="form-field">
                        <label for="userName">Nombre completo</label>
                        <input
                          id="userName"
                          name="name"
                          type="text"
                          placeholder="Ej. Juan Pérez"
                          required
                        />
                      </div>
                      <div class="form-field">
                        <label for="userRole">Rol</label>
                        <select
                          id="userRole"
                          name="role"
                          data-default="docente"
                        >
                          <option value="docente" selected>Docente</option>
                          <option value="auxiliar">Auxiliar</option>
                          <option value="administrador">Administrador</option>
                        </select>
                      </div>
                      <div class="form-field">
                        <label for="userCareer">Carrera</label>
                        <select
                          id="userCareer"
                          name="career"
                          data-default="software"
                        >
                          <option value="software" selected>
                            Ing. en Software
                          </option>
                          <option value="manufactura">
                            Ing. en Manufactura
                          </option>
                          <option value="mecatronica">
                            Ing. en Mecatrónica
                          </option>
                          <option value="global">
                            General (todas las carreras)
                          </option>
                        </select>
                      </div>
                      <div class="form-field">
                        <label for="userId">ID</label>
                        <input
                          id="userId"
                          name="id"
                          type="text"
                          placeholder="Ej. u-doc-5"
                        />
                      </div>
                      <div class="form-field">
                        <label for="userControlNumber">Número de control</label>
                        <input
                          id="userControlNumber"
                          name="controlNumber"
                          type="text"
                          placeholder="Ej. D230205"
                        />
                      </div>
                      <div class="form-field">
                        <label for="userPotroEmail">Correo Potro</label>
                        <input
                          id="userPotroEmail"
                          name="potroEmail"
                          type="email"
                          placeholder="nombre.apellido@potros.itson.edu.mx"
                        />
                      </div>
                      <div class="form-field">
                        <label for="userInstitutionalEmail">
                          Correo institucional
                        </label>
                        <input
                          id="userInstitutionalEmail"
                          name="institutionalEmail"
                          type="email"
                          placeholder="nombre.apellido@itson.edu.mx"
                        />
                      </div>
                      <div class="form-field">
                        <label for="userAltEmail">Correo alterno</label>
                        <input
                          id="userAltEmail"
                          name="email"
                          type="email"
                          placeholder="correo.personal@dominio.com"
                        />
                      </div>
                      <div class="form-field">
                        <label for="userPhone">Teléfono</label>
                        <input
                          id="userPhone"
                          name="phone"
                          type="tel"
                          placeholder="Ej. (644) 123 4567"
                        />
                      </div>
                    </div>
                    <label class="form-checkbox">
                      <input
                        type="checkbox"
                        id="userAllowExternalAuth"
                        name="allowExternalAuth"
                      />
                      <span>Permitir inicio de sesión con correo externo</span>
                    </label>
                    <p class="form-hint">
                      Solo el administrador principal puede agregar, editar o
                      eliminar usuarios.
                    </p>
                    <div class="form-actions">
                      <button type="submit" class="primary" id="userFormSubmit">
                        Guardar usuario
                      </button>
                      <button type="button" class="ghost" id="cancelUserFormBtn">
                        Cancelar
                      </button>
                    </div>
                  </form>
                  <div id="userFormAlert"></div>
                  <div id="inviteAlert"></div>
                  <div id="userTableContainer" class="table-responsive"></div>
                </div>
              </div>

              <div
                class="card"
                id="activityManagementCard"
                data-nav-label="Gestión de actividades"
                data-nav-roles="administrador"
              >
                <div class="card-title">
                  <div>
                    <h2>Gestión de Actividades</h2>
                    <p class="card-subtitle">
                      Registra tareas clave y da seguimiento al avance del
                      equipo.
                    </p>
                  </div>
                </div>
                <form id="adminActivityForm">
                  <div class="grid activity-form-grid">
                    <div class="form-field">
                      <label for="activityTitle">Título de la actividad</label>
                      <input
                        id="activityTitle"
                        name="title"
                        type="text"
                        required
                        placeholder="Ej. Seguimiento de planeaciones"
                      />
                    </div>
                    <div class="form-field">
                      <label for="activityDueDate">Fecha límite</label>
                      <input
                        id="activityDueDate"
                        name="dueDate"
                        type="date"
                        required
                      />
                    </div>
                    <div class="form-field" style="grid-column: 1 / -1">
                      <label for="activityDescription">Descripción</label>
                      <textarea
                        id="activityDescription"
                        name="description"
                        rows="3"
                        placeholder="Describe el objetivo y entregables de la actividad"
                      ></textarea>
                    </div>
                    <div class="form-field">
                      <label for="activityCareer">Carrera</label>
                      <select id="activityCareer" name="career" required>
                        <option value="global" selected>
                          General (todas las carreras)
                        </option>
                        <option value="software">Ing. en Software</option>
                        <option value="manufactura">Ing. en Manufactura</option>
                        <option value="mecatronica">Ing. en Mecatrónica</option>
                      </select>
                    </div>
                    <div class="form-field">
                      <label for="activityRole">Responsable</label>
                      <select id="activityRole" name="responsibleRole" required>
                        <option value="docente">Docente</option>
                        <option value="auxiliar">Profesor auxiliar</option>
                        <option value="administrador">Administrador</option>
                      </select>
                    </div>
                    <div class="form-field">
                      <label for="activityEmail">Correo del responsable (opcional)</label>
                      <input
                        id="activityEmail"
                        name="responsibleEmail"
                        type="email"
                        placeholder="persona@potros.itson.edu.mx"
                      />
                    </div>
                  </div>
                  <button class="primary" type="submit">
                    <i data-lucide="plus"></i>
                    <span>Registrar actividad</span>
                  </button>
                </form>
                <div id="adminActivityAlert"></div>
                <div id="adminActivityList" class="activity-table"></div>
              </div>
            </div>

            <!-- Vistas de Docente -->
            <div id="docenteView" class="hidden">
              <div
                class="card"
                id="teacherActivitiesCard"
                data-nav-label="Mis actividades"
                data-nav-roles="docente"
              >
                <div class="card-title">
                  <div>
                    <h2>Mis Actividades</h2>
                    <p class="card-subtitle">
                      Consulta el estado de cada actividad asignada a tu
                      usuario.
                    </p>
                  </div>
                </div>
                <div id="teacherActivities" class="activity-cards"></div>
              </div>
            </div>

            <!-- Vistas de Auxiliar -->
            <div id="auxiliarView" class="hidden">
              <div
                class="card"
                id="auxiliarActivitiesCard"
                data-nav-label="Actividades de apoyo"
                data-nav-roles="auxiliar"
              >
                <div class="card-title">
                  <div>
                    <h2>Actividades de Apoyo</h2>
                    <p class="card-subtitle">
                      Actualiza el estado para mantener informado al equipo.
                    </p>
                  </div>
                </div>
                <div class="activity-legend">
                  <span class="status-badge status-pendiente">Pendiente</span>
                  <span class="status-badge status-en_progreso">En progreso</span>
                  <span class="status-badge status-completada">Completada</span>
                </div>
                <div id="auxiliarActivityAlert"></div>
                <div id="auxiliarActivityList" class="activity-cards"></div>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>

    <!-- Configuración de Firebase -->
    <script>
      window.firebaseConfig = window.firebaseConfig || {
        apiKey: "AIzaSyBWa6nNgWGdsqS12OhqAfIlJcSbT59cLGs",
        authDomain: "tablerocontroldocente.firebaseapp.com",
        projectId: "tablerocontroldocente",
        storageBucket: "tablerocontroldocente.firebasestorage.app",
        messagingSenderId: "184781501380",
        appId: "1:184781501380:web:cc14875f679e077f28ea91",
      };
    </script>
    <!-- Lógica de la Aplicación -->
    <script src="script.js" type="module"></script>
  </body>
</html>
